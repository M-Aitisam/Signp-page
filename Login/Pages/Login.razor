@page "/login"
@inject NavigationManager Navigation
@inject Dal.LoginDal loginDal

<EditForm Model="@user" OnValidSubmit="HandleValidSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div>
        <label>Username:</label>
        <InputText @bind-Value="user.Username" />
    </div>

    <div>
        <label>Password:</label>
        <InputText @bind-Value="user.Password" type="password" />
    </div>

    <button type="submit">Login</button>

    @if (!string.IsNullOrEmpty(errorMessage))
    {
        <div class="alert alert-danger">@errorMessage</div>
    }
</EditForm>

@code {
    private Model.LoginModel user = new Model.LoginModel();
    private string? errorMessage;

    private void HandleValidSubmit()
    {
        if (!string.IsNullOrWhiteSpace(user.Username) && !string.IsNullOrWhiteSpace(user.Password))
        {
            var loggedInUser = loginDal.LoginUser(user.Username, user.Password);
            if (loggedInUser != null)
            {
                Navigation.NavigateTo("/index");
            }
            else
            {
                errorMessage = "Invalid username or password.";
            }
        }
        else
        {
            errorMessage = "Username and password are required.";
        }
    }
}
